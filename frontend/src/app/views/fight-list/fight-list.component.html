<app-mat-spinner-overlay [overlay]="true"></app-mat-spinner-overlay>
<div class="fight-view">
  <div class="fights-table">
    <div class="upper-menu">
      <div class="cell">
        <button mat-button color="secondary" (click)="goBackToTournament()" [matTooltipShowDelay]="500"
                matTooltip="{{'back' | translate}}"
                *ngIf="(RbacActivity.READ_ALL_TOURNAMENTS | rbac : this.rbacService.activities)">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <button class="add-button" mat-button color="primary" (click)="addElement()"
                [disabled]="tournament && tournament.locked"
                [matTooltipShowDelay]="500" matTooltip="{{'addFight' | translate}}"
                *ngIf="(RbacActivity.CREATE_FIGHT | rbac : this.rbacService.activities)">
          <mat-icon>add</mat-icon>
        </button>
        <button class="delete-button" mat-button color="warn"
                [disabled]="showSelectedRelatedButton() || (tournament && tournament.locked)"
                (click)="deleteElement()" [matTooltipShowDelay]="500" matTooltip="{{'delete' | translate}}"
                *ngIf="(RbacActivity.DELETE_FIGHT | rbac : this.rbacService.activities)">
          <mat-icon>clear</mat-icon>
        </button>
        <button mat-button color="primary" (click)="openConfirmationGenerateElementsDialog()"
                [disabled]="(tournament && tournament.locked)"
                [matTooltipShowDelay]="500" matTooltip="{{'wizard' | translate}}"
                *ngIf="isWizardEnabled && (RbacActivity.CREATE_FIGHT | rbac : this.rbacService.activities)">
          <mat-icon>auto_fix_high</mat-icon>
        </button>
        <mat-divider class="timer-divider" [vertical]="true"></mat-divider>
        <button mat-button color="primary" [disabled]="!selectedFight || (tournament && tournament.locked)"
                (click)="finishDuel(true)"
                [matTooltipShowDelay]="500" matTooltip="{{'finishFight' | translate}}"
                *ngIf="(RbacActivity.EDIT_FIGHT | rbac : this.rbacService.activities)">
          <mat-icon>check_circle</mat-icon>
        </button>
        <button class="timer-button" mat-button color="primary" [matTooltipShowDelay]="500"
                matTooltip="{{'chronometerOn' | translate}}"
                [disabled]="showSelectedRelatedButton() && !canStartFight(selectedDuel)"
                *ngIf="!timer && (RbacActivity.EDIT_FIGHT | rbac : this.rbacService.activities)"
                (click)="showTimer(canStartFight(selectedDuel))">
          <mat-icon>timer</mat-icon>
        </button>
        <button class="timer-button" mat-button color="primary" [matTooltipShowDelay]="500"
                matTooltip="{{'chronometerOff' | translate}}"
                [disabled]="showSelectedRelatedButton() && !canStartFight(selectedDuel)"
                *ngIf="timer && (RbacActivity.EDIT_FIGHT | rbac : this.rbacService.activities)"
                (click)="showTimer(false)">
          <mat-icon>timer_off</mat-icon>
        </button>
        <mat-divider [vertical]="true"></mat-divider>
        <button class="exchange-colors" mat-button color="primary" (click)="swapColors()"
                [matTooltipShowDelay]="500" matTooltip="{{'swapColors' | translate}}"
                *ngIf="(RbacActivity.CHANGE_FIGHT_COLORS | rbac : this.rbacService.activities)">
          <mat-icon svgIcon="exchange-colors" class="kendo-icon"></mat-icon>
        </button>
        <button class="exchange-teams" mat-button color="primary" (click)="swapTeams()"
                [matTooltipShowDelay]="500" matTooltip="{{'swapTeams' | translate}}"
                *ngIf="(RbacActivity.SWAP_FIGHTS | rbac : this.rbacService.activities)">
          <mat-icon svgIcon="exchange-teams" class="kendo-icon"></mat-icon>
        </button>
        <button class="member-order" mat-button color="primary" (click)="enableMemberOrder(true)"
                [disabled]="(tournament && tournament.locked)"
                [matTooltipShowDelay]="500" matTooltip="{{'membersOrder' | translate}}"
                *ngIf="!membersOrder && (RbacActivity.CHANGE_MEMBERS_ORDER | rbac : this.rbacService.activities)">
          <mat-icon svgIcon="member-order" class="kendo-icon"></mat-icon>
        </button>
        <button class="member-order" mat-button color="primary" (click)="enableMemberOrder(false)"
                [disabled]="(tournament && tournament.locked)"
                [matTooltipShowDelay]="500" matTooltip="{{'membersOrder' | translate}}"
                *ngIf="membersOrder && (RbacActivity.CHANGE_MEMBERS_ORDER | rbac : this.rbacService.activities)">
          <mat-icon svgIcon="member-order-disable" class="kendo-icon"></mat-icon>
        </button>
        <mat-divider [vertical]="true"></mat-divider>
        <button mat-button color="primary" [disabled]="!groups[0] || !groups[0].fights || groups[0].fights.length == 0"
                [matTooltipShowDelay]="500" matTooltip="{{'teamsRanking' | translate}}"
                *ngIf="((tournament && tournament.teamSize && tournament.teamSize>1) || (tournament && tournament.type === kingOfTheMountainType))
                 && (RbacActivity.READ_TEAMS_RANKINGS | rbac : this.rbacService.activities)"
                (click)="showTeamsClassification(areAllDuelsOver())">
          <mat-icon svgIcon="teams-classification" class="kendo-icon"></mat-icon>
        </button>
        <button class="competitors-classification" mat-button color="primary"
                [disabled]="!groups[0] || !groups[0].fights || groups[0].fights.length == 0"
                [matTooltipShowDelay]="500" matTooltip="{{'competitorsRanking' | translate}}"
                *ngIf="(RbacActivity.READ_TEAMS_RANKINGS | rbac : this.rbacService.activities)"
                (click)="showCompetitorsClassification()">
          <mat-icon svgIcon="competitors-classification" class="kendo-icon"></mat-icon>
        </button>
        <mat-divider class="download-divider" [vertical]="true"></mat-divider>
        <button class="download-button" mat-button color="primary"
                [disabled]="!groups[0] || !groups[0].fights || groups[0].fights.length == 0"
                [matTooltipShowDelay]="500" matTooltip="{{'fightList' | translate}}"
                *ngIf="(RbacActivity.READ_ALL_FIGHTS | rbac : this.rbacService.activities)"
                (click)="downloadPDF()">
          <mat-icon>file_download</mat-icon>
        </button>
      </div>
    </div>
    <app-filter (filterChanged)="filter($event)" (reset)="filter('')" [resetValue]="resetFilterValue"></app-filter>
    <app-timer [startingMinutes]="getDuelDefaultMinutesDuration()" [startingSeconds]="getDuelDefaultSecondsDuration()"
               [hidden]="!timer" [editable]="tournament && !tournament.locked" (onTimerFinished)="finishDuel($event[0])"
               (onTimerChanged)="updateDuelElapsedTime($event[0], true)"
               (onSoftTimerChanged)="updateDuelElapsedTime($event[0], false)" [resetTimerPosition]="resetTimerPosition"
               (onPlayPressed)="duelStarted($event[0])"
               (timeDurationChanged)="updateDuelDuration($event[0])" (timerClosed)="showTimer(false)"></app-timer>
    <div class="fight-container">
      <div class="fight-list" *ngFor="let group of groups">
        <div class="fights-of-group">
          <fight *ngFor="let fight of filteredFights.get(group.id!)" [fight]="fight" [selected]="fight === selectedFight"
                 [over]="isFightOver(fight)" [swapColors]="swappedColors" [swapTeams]="swappedTeams"
                 (click)="selectFight(fight)" [showAvatars]="showAvatars"
                 (onSelectedDuel)="selectDuel($event[0])"></fight>
        </div>
        <div class="unties-list">
          <untie-fight *ngFor="let duel of filteredUnties.get(group.id!)" [duel]="duel" (click)="selectDuel(duel)"
                       [selected]="duel === selectedDuel" [swapColors]="swappedColors" [swapTeams]="swappedTeams"
                       [ngClass]="{duelSelected: duel === selectedDuel, over: isOver(duel)}"></untie-fight>
        </div>
      </div>
    </div>
  </div>
</div>
